{% extends "dash_temp.html" %}

{% block title %}Staff Dashboard{% endblock %}
{% block page %}Staff Dashboard{% endblock %}

{% block tabs %}
<div class="tabs-container center-align" style="margin-top: 20px;">
  <a href="#" class="tab-link active" data-tab="applications">Applications</a>
  <a href="#" class="tab-link" data-tab="shortlist">Shortlist</a>
</div>
{% endblock %}

{% block search %}
<div class="search-container center-align">
  <div class="input-field" style="max-width: 300px; margin: 0 auto;">
    <i class="material-icons prefix">search</i>
    <input id="application-search" type="text" placeholder="Search applications or shortlist...">
  </div>
</div>
{% endblock %}

{% block content %}
<div id="applications" class="tab-content active scrollable-section">
  {% for application in applications %}
  <div class="card horizontal z-depth-1 application-card scrollable-cards" style="display: flex;"
       data-student="{{ application.student.username | lower }}"
       data-internship="{{ application.internship.title | lower }}">
    <div class="card-image center-align" style="padding: 20px;">
      <i class="material-icons large">assignment_ind</i>
    </div>
    <div class="card-stacked">
      <div class="card-content">
        <p><strong>Student:</strong> {{ application.student.username }}</p>
        <p><strong>Internship:</strong> {{ application.internship.title }}</p>
        <p><strong>Status:</strong> {{ application.status }}</p>
      </div>
      <div class="card-action right-align">
        <form action="/staff/view_application/{{ application.id }}" method="get" style="display: inline;">
          <button type="submit" class="btn blue">View Application</button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div id="shortlist" class="tab-content scrollable-section">
  {% for shortlist in shortlist %}
  <div class="card horizontal z-depth-1 shortlist-card scrollable-cards" style="display: flex;"
       data-internship="{{ shortlist.internship.title | lower }}">
    <div class="card-image center-align" style="padding: 20px;">
      <i class="material-icons large">star</i>
    </div>
    <div class="card-stacked">
      <div class="card-content">
        <p><strong>Internship:</strong> {{ shortlist.internship.title }}</p>
        <p><strong>Applications:</strong> {{ shortlist.applications | length }}</p>
      </div>
      <div class="card-action right-align">
        <a href="/staff/view_internship/{{ shortlist.internship.id }}" class="btn orange">View Shortlist</a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const tabs = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', function (e) {
        e.preventDefault();
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(tc => tc.classList.remove('active'));
        this.classList.add('active');
        const targetTab = this.dataset.tab;
        document.getElementById(targetTab).classList.add('active');
      });
    });

    const searchInput = document.getElementById('application-search');
    if (searchInput) {
      searchInput.addEventListener('input', function () {
        const filter = this.value.toLowerCase();

        document.querySelectorAll('.application-card, .shortlist-card').forEach(card => {
          const student = card.getAttribute('data-student') || '';
          const internship = card.getAttribute('data-internship') || '';
          if (
            student.includes(filter) || internship.includes(filter)
          ) {
            card.style.display = 'flex';
          } else {
            card.style.display = 'none';
          }
        });
      });
    }
  });
</script>
{% endblock %}
